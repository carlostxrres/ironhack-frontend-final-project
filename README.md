## Apuntes de clase 2024-06-04

### Iniciar un proyecto en Supabase

...

Ahora, añadimos la tabla inicial de tareas. Para ello, copiaremos este código y lo pegaremos en la consola de SQL de Supabase (Settings > SQL Editor):

```sql
create table tasks (
  -- This first part sets up the tables
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  title text check (char_length(title) > 3),
  is_complete boolean default false,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null
);
alter table tasks enable row level security;
-- Then it creates a policy that lets authenticated users create task
create policy "Individuals can create a task." on tasks for
insert with check (auth.uid() = user_id);
-- Then it creates a policy that users can only view their own task (select task based on user id)
create policy "Individuals can view their own task. " on tasks for
select using (auth.uid() = user_id);
-- Then it does the same only for update
create policy "Individuals can update their own task." on tasks for
update using (auth.uid() = user_id);
-- And again for delete
create policy "Individuals can delete their own task." on tasks for
delete using (auth.uid() = user_id);
```

Entonces, hacemos click en "Run" y ya tendremos la tabla de tareas inicial creada.

Ahora, en la parte de Authentication > Providers > Email, deberíamos deshabilitar "Confirm email" para que no sea necesario confirmar el email de los usuarios.

### Iniciar un proyecto normal de Vue

Instalar supabase. Seguir las instrucciones en la documentación: https://supabase.com/docs/reference/javascript/installing

### Añadir Supabase al proyecto de Vue.js

Instalamos Supabase.

```bash
npm install @supabase/supabase-js
```

Creamos un fichero `lib/supabase.js`. En él, escribimos el siguiente contenido:

```javascript
import { createClient } from
// ...
```

Creamos un fichero `.env`. En él, escribimos las variables de entorno que podemos encontrar en la configuración de Supabase:

- Settings > API > API URL
- Settings > API > API Key

```bash
SUPABASE_PASSWORD = aaaaaaaaaaa
VITE_SUPABASE_API_KEY = aaaaaaaaaaa
VITE_SUPABASE_URL = https://aaaaaaaaaaa.supabase.co
```

Ojo: antes de subir el proyecto a un repositorio, deberíamos asegurarnos de que `.env` está en el fichero `.gitignore` y comentar el contenido añadiendo una almohadilla (`#`) al principio de cada línea, así como añadir un string arbitrario (como por ejemplo `xxxx`) en medio de cada valor crítico:

```bash
# SUPABASE_PASSWORD = aaaaa xxxx aaaaaa
# VITE_SUPABASE_API_KEY = aaaaa xxxx aaaaaa
# VITE_SUPABASE_URL = aaaaa xxxx aaaaaa
```

### Crear stores

- Crear una store para los usuarios (user.js). Con el contenido de la plantilla.
- Crear una store para las tareas (task.js). Con el contenido de la plantilla.

### Empezamos a crear views

Añadir la vista HomeView.vue
Añadir la vista HomeView al router

### Añadir funcionalidades

Revisar la documentación de Supabase. Por ejemplo, para crear un nuevo usuario con email y contraseña: https://supabase.com/docs/reference/javascript/auth-signup (esto está en la store user.js)

Con el user.user.id, podremos vincular tareas al usuario.

En la store user.js, tendremos que añadir un método para loguearse. Estas cosas las tendremos que ir viendo en la documentación: https://supabase.com/docs/reference/javascript/auth-signinwithidtoken

En la store task.js, tendremos que añadir un método para crear tareas. Esto también está en la documentación: https://supabase.com/docs/reference/javascript/insert (ojo, en este caso no es necesario añadir el id en el métidi .insert())

Otras:

- Modificar tareas
- Borrar tareas
- Listar tareas
- ¿Borrar usuario?
